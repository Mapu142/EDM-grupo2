---
title: "LABORATORIO_3"
author:
  - Sergio Alejandro Buitrago Melo
  - María Alejandra Cabra Arias
  - María Paula Camargo Rincón
  - Ana María Chacón Bello
  - Sergio Alejandro Gaona Díaz
  - Juan Esteban García Muete
date: '2025-05-14'
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

## hola mundo

los comandos son (usenlo en la terminal, no en la consola):

git pull origin main git add . git commit -m "comentario" git push
origin Tu_rama

hacen el pull request


-se pasan a main local -git pull origin main -luego a su rama local -git
merge main -git push origin su rama




Laboratorio #2

Librerias y preliminares:

```{r}
#librerias
library(readxl)
library(FactoMineR)
library(ggplot2)
library(factoextra)
library(dplyr)
library(tibble)
library(sqldf)
#base de datos
ciudades <- read_xlsx("Ciudades.xlsx")
summary(ciudades)
str(ciudades)
View(ciudades)
#rownames(ciudades) = ciudades$CIUDADES
```

Se realizaràn los distintos ACP con las variables de RH e INFRA

```{r}
#base de datos RH+INFRA
ciudadest<-ciudades[,c(1:15,21:30)]
rownames(ciudadest) = ciudades$CIUDADES
str(ciudadest)
View(ciudadest)

```

PRIMER PUNTO

```{r}
#ACP todas las variables que le corresponden####
# Ahora convierte esa columna en rownames
ciudadest <- column_to_rownames(ciudadest, var = "CIUDADES")
acp1<-PCA(ciudadest,ncp = 7)
PCA(ciudadest,ncp = 7,axes = c(2,3))
for (i in 1:7) {
  if (i+1<=7) {
    PCA(ciudadest,ncp = 7,axes = c(i,i+1))
  }
}
plot(acp1$ind$coord[, 1:2], type = "n")
text(acp1$ind$coord[, 1:2], labels = rownames(ciudadest), cex = 0.8)
```




```{r}
#contiene los auto valores correspondientes a los componentes principales
acp1$eig

#al sumar la columna de los eigenvalue da 24
sum(acp1$eig[,1])

#la coluna de porcentages de varianza acumulados
#nos muestra que tan importantes son los primeros componentes
# y es notable como con los primeros 7 ya se acumula
# el 83 porciento de la varianza
acp1$eig[,3]

#coordenadas de las variables
acp1$var$coord

#correlaciones variable factor
acp1$var$cor
#basicamente estas covarianzas nos habla de como las variables
#se relacionan con los factores y en que medida los construye

#cosenos cuadrados de las variables
acp1$var$cos2

acp1$ind$cos2
```
Gràficos primer punto 

```{r}

#  Gráfico de individuos 
G11<-fviz_pca_ind(acp1, geom = 'text',
             col.ind = "cos2",  # calidad de representación
             gradient.cols = c("darkgreen",  "#FC4E07"),
             repel = TRUE
)
G11
```
```{r}
# Supongamos que 'acp1' es el resultado de tu análisis PCA
# y que 'otro_dataframe' es el otro dataframe con el que quieres asociar los individuos.
# Este 'otro_dataframe' debería tener al menos una columna que corresponda
# al número de fila o a algún identificador de los individuos en 'ciudadest'.
# Asumiremos que esta columna se llama 'ID_Individuo'.

# 1. Obtener la matriz de cosenos cuadrados de los individuos
cos2_ind <- as.data.frame(acp1$ind$cos2)

# 2. Crear una columna con el número de fila (que actuará como ID inicial)
#cos2_ind <- cos2_ind %>%
 # mutate(Fila = row_number())

# 3. Crear una función para obtener los 3 valores más altos y sus IDs por dimensión
#obtener_top_3 <- function(df, dimension) {
#  top_3 <- df %>%
#    select(Fila, {{ dimension }}) %>%
#    arrange(desc({{ dimension }})) %>%
#    head(3) %>%
#    rename(!!dimension := {{ dimension }}) # Mantener el nombre de la dimensión
#  return(top_3)
#}

# 4. Obtener los nombres de las dimensiones (componentes principales)
#nombres_dimensiones <- names(cos2_ind)[!names(cos2_ind) == "Fila"]

# 5. Aplicar la función a cada dimensión y combinar los resultados
#lista_top_3 <- lapply(nombres_dimensiones, function(dim) obtener_top_3(cos2_ind, as.name(dim)))
#tabla_top_3_cos2 <- bind_rows(lista_top_3, .id = "Dimension")

# 6. Unir con el otro dataframe para obtener el ID deseado
# Asegúrate de que la columna 'ID_Individuo' en 'otro_dataframe'
# se corresponde con el número de fila en el orden original de tus datos 'ciudadest'.
#tabla_final <- tabla_top_3_cos2 %>%
 # left_join(otro_dataframe, by = c("Fila" = "ID_Individuo")) %>%
  #select(Dimension, Fila, ID_Individuo, everything()) # Reorganizar columnas

# Imprimir la tabla resultante
#print(tabla_final)
```

```{r}

G12<-fviz_pca_var(acp1,
                  col.var = 'red',
                  alpha.var = 0.5,
                  select.var = list(contrib = 7),
                  repel = TRUE,
                  col.quanti.sup = 'darkgrey'
)
G12
```

```{r}


# 6. Biplot (variables + individuos)
G13<-fviz_pca_biplot(acp1,
                  col.ind = "cos2",
                  gradient.cols = c("darkgreen",  "red"),
                     col.var = "darkblue",
                     select.var = list(contrib = 7),
                  geom = "text",
                     repel = T,
                     col.quanti.sup = 'darkgrey'
)
G13
```
SEGUNDO PUNTO

```{r}

acp2<-PCA(ciudadest,quanti.sup = c(1:14))
#Solo las variables INFRA_25 a INFRA_38
#(columnas 15 a 24) serán activas.
#Las variables RH_* (1 a 14) no se usan para
#construir los ejes principales, pero se proyectan
#en el plano factorial para ser interpretadas.

#contiene los auto valores correspondientes a los componentes principales
acp2$eig

#al sumar la columna de los eigenvalue da 10
sum(acp2$eig[,1])

#la coluna de porcentages de varianza acumulados
#nos muestra que tan importantes son los primeros componentes
# y es notable como con los primeros 5 ya se acumula
# el 88 porciento de la varianza
acp2$eig[c(1:5),c(1,3)]

#coordenadas de las variables
acp2$var$coord

#correlaciones variable factor
acp2$var$cor
#basicamente estas covarianzas nos habla de como las variables
#se relacionan con los factores y en que medida los construye

#cosenos cuadrados de las variables
acp2$var$cos2

var_contrib <- data.frame(acp2$var$contrib)

top5_vars <- rownames(var_contrib)[order(var_contrib$Dim.1 + var_contrib$Dim.2, decreasing = TRUE)][1:5]
sup_vars <- rownames(acp2$quanti.sup$coord)
all_vars <- c(top5_vars, sup_vars)
s2<-acp2$eig
sum(s2[,1])
```

Gràficos punto#2:

```{r}

#  Gráfico de individuos 
G21<-fviz_pca_ind(acp2,
             col.ind = "cos2",  # calidad de representación
             gradient.cols = c("darkgreen",  "red"),
             repel = TRUE
)
G21
```

```{r}

G22<-fviz_pca_var(acp2,
                  col.var = "darkblue",
                  gradient.cols = c("darkgreen", "#E7B800", "red"),
                  alpha.var = 0.5,
                  repel = TRUE,
                  col.quanti.sup = 'darkgrey',
                  select.var = list(name =c(all_vars)),
                  title = 'Variables y suplementarias'
)

G22
```

```{r}



G23<-fviz_pca_biplot(acp2,
                     col.ind = "cos2",
                     gradient.cols = c("darkgreen", "red"),
                     col.var = "darkblue",
                     repel = T,
                     col.quanti.sup = 'darkgrey',
                     select.var = list(name =c(all_vars)),
            title = 'Biplot'
)
G23
```

Al revisar las coordenadas 3 individuos resaltan al ojo, Bogotá (3), San Andrés (17) y Riohacha (16) por ser los individuos más alejados del origen de nuestro plano, esto nos indica singularidades y posibles aspectos a destacar de estás ciudades.

Al revisar a San Andrés vemos que este guarda una relación negativa con las variables INFRA 27/28 ( acueducto y alcantarillado cada 10000 habitantes) esto explicable fácilmente gracias a su baja población y su geografía de isla que dificulta la construcción de infraestructura pública como alcantarillado.

Por el lado de la capital vemos su   alto posicionamiento en la dimensión 2, y a pesar que existe una relación destacable con INFRA 37/25 (clientes de internet y líneas telefónicas cada 10000 habitantes), el rasgo más importante de este individuo es su alta  posición en el eje Y, explicada en parte gracias a la variable de carga aérea (INFRA 33) dónde Bogota es lider seguido de cerca de San Andrés. 

En el tercer cuadrante encontramos a Riohacha, el cual es representado de manera negativa con respecto a nuestras  variables de telecomunicaciones siendo este el individuo mas destacable del lado negativo del eje X

TERCER PUNTO

```{r}
acp3<-PCA(ciudadest,quanti.sup = c(15:24),ncp = 6)
#Esto hace lo opuesto: trata las variables de
#infraestructura (15 a 24) como suplementarias y
#las variables RH (1 a 14) como activas.

#contiene los auto valores correspondientes a los componentes principales
acp3$eig

#al sumar la columna de los eigenvalue da 14
sum(acp3$eig[,1])

#la coluna de porcentages de varianza acumulados
#nos muestra que tan importantes son los primeros componentes
# y es notable como con los primeros 6 ya se acumula
# el 85 porciento de la varianza
acp3$eig[c(1:6),c(1,3)]

#coordenadas de las variables
acp3$var$coord

#correlaciones variable factor
acp3$var$cor
#basicamente estas covarianzas nos habla de como las variables
#se relacionan con los factores y en que medida los construye

#cosenos cuadrados de las variables
acp3$var$cos2
var_contrib3 <- data.frame(acp3$var$contrib)

top5_vars3 <- rownames(var_contrib3)[order(var_contrib3$Dim.1 + var_contrib3$Dim.2, decreasing = TRUE)][1:6]
sup_vars3 <- rownames(acp3$quanti.sup$coord)
all_vars3 <- c(top5_vars3, sup_vars3)


```

Gràficos punto #3

```{r}

#  Gráfico de individuos 
G31<-fviz_pca_ind(acp3,
             col.ind = "cos2",  # calidad de representación
             gradient.cols = c("darkgreen",  "#FC4E07"),
             repel = TRUE
)
G31
```

```{r}

G32<-fviz_pca_var(acp3,
                  col.var = 'red',
                  alpha.var = 0.5,
                  repel = TRUE,
                  col.quanti.sup = 'darkgrey',
                  select.var = list(name =c(all_vars3)),
                  title = 'Variables y suplementarias'
)

G32
```
```{r}
G33<-fviz_pca_biplot(acp3,
                  col.ind = "cos2",
                  gradient.cols = c("darkgreen", "red"),
                     col.var = "darkblue",
                     repel = T,
                     col.quanti.sup = 'darkgrey',
                     select.var = list(name =c(all_vars3)),
                  geom = "text",
            title = 'Biplot'
)
G33
```
