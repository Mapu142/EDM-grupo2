---
title: "LABORATORIO_4"
author:
  - Sergio Alejandro Buitrago Melo
  - María Alejandra Cabra Arias
  - María Paula Camargo Rincón
  - Ana María Chacón Bello
  - Sergio Alejandro Gaona Díaz
  - Juan Esteban García Muete
date: '2025-05-14'
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

### **Laboratorio #4**

```{r}
library(haven)
library(FactoMineR)
library(factoextra)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
ECC <- read_delim("ECC_completa_19426.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(ECC)
```

## Punto 1
```{r}
library(dplyr) # Para manejo de datos

tabla <- ECC %>%
  filter(!is.na(p17_b), !is.na(p21)) %>%
  count(p17_b, p21) %>%
  tidyr::pivot_wider(names_from = p21, values_from = n, values_fill = 0)
```



```{r}
library(tibble)
tabla <- column_to_rownames(tabla,var = "p17_b")
#Analisis de correspondencias simples 
ACS<-CA(tabla,graph=T)
```

```{r}
#autovalores
ACS$eig
```

```{r}
#coordenadas 
ACS$col$coord

#contribuciones 
ACS$col$contrib

#cosenos cuadrados
ACS$col$cos2
```
```{r}
#grafico columnas 
f_col<-fviz_ca_col(ACS)
f_col
```
```{r}
#grafico filas 
f_row<-fviz_ca_row(ACS)
f_row   
```
```{r}
#grafico biplot 
f_biplot<-fviz_ca_biplot(ACS)
f_biplot
```


## Punto 2
```{r}
library(dplyr) # Para manejo de datos
tabla_activa <- ECC %>%
  filter(!is.na(p17_b), !is.na(p21)) %>%
  count(p17_b, p21) %>%
  tidyr::pivot_wider(names_from = p21, values_from = n, values_fill = 0)
tabla_suplementaria <- ECC %>%
  filter(!is.na(p17_b), !is.na(ciudad2)) %>%
  filter(!ciudad2 %in% c("Bogota", "Asuncion", "Montevideo")) %>%
  count(p17_b, ciudad2) %>%
  tidyr::pivot_wider(names_from = ciudad2, values_from = n, values_fill = 0)
tabla_suplementaria

```


```{r}
tabla_completa <- left_join(tabla_activa, tabla_suplementaria, by = "p17_b")

tabla_completa <- column_to_rownames(tabla_completa,var="p17_b")
tabla_completa
```


```{r}
library(FactoMineR)
tabla_completa[] <- lapply(tabla_completa, as.integer)
n_col_activas <- ncol(tabla_activa) - 1
cols_suplementarias <- (n_col_activas + 1):ncol(tabla_completa)

res <- CA(tabla_completa, col.sup = cols_suplementarias)

```
p17_b:Le queda fácil actuar conforme a la ley
p21:Las personas normalmente hacen acuerdos o tratos entre si. Muchas veces son acuerdos informales (Por ejemplo, los acuerdos basados en la
 palabra, sin contrato firmado). Otras veces son acuerdos formales.¿Usted prefiere hacer acuerdos?

El gráfico muestra que aunque parezcan semánticamente similares las respuestas "siempre" y "casi siempre", al encontrarse en lados opuestos las respuestas de ambas preguntas, nos hace ver que hay una clara diferencia entre estos dos grupos ("siempre" y "casi siempre"). Notamos consistencia entre estas dos preguntas ya que las respuestas de ambas coinciden en la ubicación del gráfico, por ejemplo para las personas que siempre les queda fácil actuar conforme la ley, pueden ser las mismas que siempre realizan acuerdos, o las personas que casi siempre les queda fácil actuar conformela ley pueden ser las mismas que casi siempre prefieren hacer acuerdos, ocurre lo mismo con las respuestas "casi nunca" y "nunca" respecto a la consistencia, ya que en este grupo de respuestas pareciera que no hay diferencia entre "casi nunca" y "nunca" en la dimensión 2.
La Paz, Quito, México DF y Medellín se proyectan cerca de las respuestas "nunca" o "casi nunca" en ambas preguntas.Esto sugiere que, en estas ciudades, las personas tienden a reportar mayor dificultad para actuar conforme a la ley y menor disposición a realizar acuerdos.

Belo Horizonte está en el extremo derecho, cerca de las categorías "siempre". Indica un perfil asociado a personas que reportan cumplir siempre con la ley y prefieren siempre hacer acuerdos.

Caracas se encuentra cerca de las respuestas de "siempre" y "nunca" simultáneamente.

## Preguntas 3 y 4

### 🧽 Preparar datos

```{r}
# Seleccionar variables clave
ECC_sub <- ECC %>% select(p17_b, p21, ciudad = ciudad2)

# Eliminar casos con datos faltantes y asegurar factores
ECC_sub <- ECC_sub %>%
  filter(!is.na(p17_b), !is.na(p21), !is.na(ciudad)) %>%
  mutate(
    p17_b = as.factor(p17_b),
    p21   = as.factor(p21),
    ciudad = as.factor(ciudad)
  )
```

## 🔍 Punto 3: Análisis de Correspondencias Simples (ACS) entre p17_b y p21

```{r}
# Tabla de contingencia
tabla1 <- table(ECC_sub$p17_b, ECC_sub$p21)

# Ejecutar el ACS
res.acs <- CA(tabla1, graph = FALSE)

# Mostrar resumen
summary(res.acs)
```

### 📝 Interpretación del ACS

El análisis de correspondencias simples entre la percepción de facilidad para cumplir la ley (p17_b) y la preferencia por hacer acuerdos (p21) revela una asociación significativa (χ² = 290.54, p < 0.001).

La primera dimensión explica el 83.7% de la varianza, lo que indica que existe una fuerte estructura en los datos.

- Las personas que consideran más fácil cumplir la ley (categorías 3 y 4 de p17_b) tienden a estar más de acuerdo con hacer acuerdos (categorías 3 y 4 de p21).

- En contraste, quienes perciben que es difícil cumplir la ley (categorías 1 y 2 de p17_b) muestran menor acuerdo con hacer acuerdos.

Esta asociación sugiere que las personas que consideran fácil cumplir la ley tienden a mostrar mayor preferencia por hacer acuerdos, mientras que aquellas que consideran difícil cumplir la ley manifiestan menor disposición hacia el consenso. Esta relación se observa claramente en el primer eje del plano factorial, que explica más del 80% de la varianza.

### 📈 Visualización del ACS

```{r}
fviz_ca_biplot(res.acs, repel = TRUE) +
  labs(title = "ACS: Facilidad para cumplir la ley (p17_b) vs Preferencia por acuerdos (p21)")
```





### 🔍 Interpretación gráfico:

Este gráfico representa un plano factorial del Análisis de Correspondencias Simples (ACS) entre:

- p17_b: Facilidad para cumplir la ley

- p21: Preferencia por hacer acuerdos

Cada punto representa una categoría de respuesta de cada variable, y su posición indica relaciones de asociación:

Los puntos más cercanos entre sí indican que esas categorías tienden a coaparecer en las respuestas.

Los extremos del eje Dim.1 (que explica el 83.7% de la variabilidad) separan a los encuestados en función de sus respuestas.

🧩 Hallazgos clave:
En el cuadrante inferior derecho, se agrupan:

- p17b_FACL=4_s (muy fácil cumplir la ley)

- p21_HACACU=4_s (muy de acuerdo con hacer acuerdos)

Esto indica que quienes consideran que es muy fácil cumplir la ley tienden a estar muy de acuerdo con hacer acuerdos.

En el cuadrante superior izquierdo, aparecen:

- p17b_FACL=1_n y 2_cn (nada o poco fácil cumplir la ley)

- p21_HACACU=1_n y 2_cn (nada o poco de acuerdo con hacer acuerdos)

Esto sugiere que quienes consideran que cumplir la ley es difícil también tienden a estar menos de acuerdo con hacer acuerdos.

📌 Conclusión: Existe una clara asociación entre ambas variables. La percepción de legalidad parece estar positivamente relacionada con la disposición al consenso.

## 🌍 Punto 4: Preferencia por acuerdos (p21) según ciudad

```{r}
# Tabla de frecuencias
tabla2 <- table(ECC_sub$ciudad, ECC_sub$p21)

# Proporciones por ciudad (filas)
prop_ciudad <- prop.table(tabla2, margin = 1)

# Convertir a formato largo
df_plot <- as.data.frame(prop_ciudad) %>%
  rename(ciudad = Var1, p21 = Var2, proporcion = Freq)
```

### 📊 Gráfico de barras apiladas por ciudad

```{r}
ggplot(df_plot, aes(x = ciudad, y = proporcion, fill = p21)) +
  geom_bar(stat = "identity") +
  labs(title = "Preferencia por hacer acuerdos (p21) por ciudad",
       x = "Ciudad", y = "Proporción") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
### 🔍 Interpretación gráfico:
Este gráfico de barras apiladas muestra las proporciones de respuestas a la pregunta p21 por ciudad. Se analizan 4 niveles:

- 1_n: Nada de acuerdo

- 2_cn: Poco de acuerdo

- 3_cs: De acuerdo

- 4_s: Muy de acuerdo

🧩 Hallazgos clave:

- Bogotá destaca con una alta proporción en la categoría 4_s (muy de acuerdo), similar a Asunción y Medellín.

- Caracas y Montevideo tienen una mayor proporción en 1_n y 2_cn, indicando menos disposición a hacer acuerdos.

- México DF muestra una distribución más equilibrada, pero con una leve inclinación hacia el acuerdo (3_cs).

📌 Conclusión: Existen diferencias claras entre ciudades. Algunas, como Bogotá, muestran un perfil más orientado al consenso, mientras que otras como Caracas presentan una mayor resistencia.

```{r}

```


```{r}

```
### **Laboratorio 5**
```{r librerias, message=FALSE, warning=FALSE}
datos_bogota <- ECC %>%
  filter(ciudad2 == "Bogota")
```

# Filtrado variables activas

```{r librerias, message=FALSE, warning=FALSE}
vars_act <- c(
  "p20_a","p20_b","p20_c","p20_d","p20_e",
  "p20_f","p20_g","p20_h","p20_i","p20_j",
  "p20_k","p21","p27",
  "p33_a","p33_b","p33_c","p33_d","p33_e",
  "p33_f","p33_g","p33_h","p33_i","p33_j",
  "p33_k","p33_l","p33_m","p33_n","p33_o","p33_p"
)
df_mca <- datos_bogota[, vars_act]

```

# Calculo de MCA

```{r librerias, message=FALSE, warning=FALSE}
mca <- MCA(df_mca, graph = FALSE)

```

# Gráfico individuos

```{r librerias, message=FALSE, warning=FALSE}
fviz_mca_ind(
  mca,
  col.ind = "cos2",
  title   = "MCA: Individuos"
)

```