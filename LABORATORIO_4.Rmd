---
title: "LABORATORIO_4"
author:
  - Sergio Alejandro Buitrago Melo
  - Mar칤a Alejandra Cabra Arias
  - Mar칤a Paula Camargo Rinc칩n
  - Ana Mar칤a Chac칩n Bello
  - Sergio Alejandro Gaona D칤az
  - Juan Esteban Garc칤a Muete
date: '2025-05-14'
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

### **Laboratorio #4**

```{r}
library(haven)
library(FactoMineR)
library(factoextra)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
ECC <- read_delim("ECC_completa_19426.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
View(ECC)
```

## Punto 1
```{r}
library(dplyr) # Para manejo de datos

tabla <- ECC %>%
  filter(!is.na(p17_b), !is.na(p21)) %>%
  count(p17_b, p21) %>%
  tidyr::pivot_wider(names_from = p21, values_from = n, values_fill = 0)
```



```{r}
library(tibble)
tabla <- column_to_rownames(tabla,var = "p17_b")
#Analisis de correspondencias simples 
ACS<-CA(tabla,graph=T)
```

```{r}
#autovalores
ACS$eig
```

```{r}
#coordenadas 
ACS$col$coord

#contribuciones 
ACS$col$contrib

#cosenos cuadrados
ACS$col$cos2
```
```{r}
#grafico columnas 
f_col<-fviz_ca_col(ACS)
f_col
```
```{r}
#grafico filas 
f_row<-fviz_ca_row(ACS)
f_row   
```
```{r}
#grafico biplot 
f_biplot<-fviz_ca_biplot(ACS)
f_biplot
```


## Punto 2
```{r}
library(dplyr) # Para manejo de datos
tabla_activa <- ECC %>%
  filter(!is.na(p17_b), !is.na(p21)) %>%
  count(p17_b, p21) %>%
  tidyr::pivot_wider(names_from = p21, values_from = n, values_fill = 0)
tabla_suplementaria <- ECC %>%
  filter(!is.na(p17_b), !is.na(ciudad2)) %>%
  filter(!ciudad2 %in% c("Bogota", "Asuncion", "Montevideo")) %>%
  count(p17_b, ciudad2) %>%
  tidyr::pivot_wider(names_from = ciudad2, values_from = n, values_fill = 0)
tabla_suplementaria

```


```{r}
tabla_completa <- left_join(tabla_activa, tabla_suplementaria, by = "p17_b")

tabla_completa <- column_to_rownames(tabla_completa,var="p17_b")
tabla_completa
```


```{r}
library(FactoMineR)
tabla_completa[] <- lapply(tabla_completa, as.integer)
n_col_activas <- ncol(tabla_activa) - 1
cols_suplementarias <- (n_col_activas + 1):ncol(tabla_completa)

res <- CA(tabla_completa, col.sup = cols_suplementarias)

```
p17_b:Le queda f치cil actuar conforme a la ley
p21:Las personas normalmente hacen acuerdos o tratos entre si. Muchas veces son acuerdos informales (Por ejemplo, los acuerdos basados en la
 palabra, sin contrato firmado). Otras veces son acuerdos formales.쯋sted prefiere hacer acuerdos?

El gr치fico muestra que aunque parezcan sem치nticamente similares las respuestas "siempre" y "casi siempre", al encontrarse en lados opuestos las respuestas de ambas preguntas, nos hace ver que hay una clara diferencia entre estos dos grupos ("siempre" y "casi siempre"). Notamos consistencia entre estas dos preguntas ya que las respuestas de ambas coinciden en la ubicaci칩n del gr치fico, por ejemplo para las personas que siempre les queda f치cil actuar conforme la ley, pueden ser las mismas que siempre realizan acuerdos, o las personas que casi siempre les queda f치cil actuar conformela ley pueden ser las mismas que casi siempre prefieren hacer acuerdos, ocurre lo mismo con las respuestas "casi nunca" y "nunca" respecto a la consistencia, ya que en este grupo de respuestas pareciera que no hay diferencia entre "casi nunca" y "nunca" en la dimensi칩n 2.
La Paz, Quito, M칠xico DF y Medell칤n se proyectan cerca de las respuestas "nunca" o "casi nunca" en ambas preguntas.Esto sugiere que, en estas ciudades, las personas tienden a reportar mayor dificultad para actuar conforme a la ley y menor disposici칩n a realizar acuerdos.

Belo Horizonte est치 en el extremo derecho, cerca de las categor칤as "siempre". Indica un perfil asociado a personas que reportan cumplir siempre con la ley y prefieren siempre hacer acuerdos.

Caracas se encuentra cerca de las respuestas de "siempre" y "nunca" simult치neamente.

## Preguntas 3 y 4

### 游빟 Preparar datos

```{r}
# Seleccionar variables clave
ECC_sub <- ECC %>% select(p17_b, p21, ciudad = ciudad2)

# Eliminar casos con datos faltantes y asegurar factores
ECC_sub <- ECC_sub %>%
  filter(!is.na(p17_b), !is.na(p21), !is.na(ciudad)) %>%
  mutate(
    p17_b = as.factor(p17_b),
    p21   = as.factor(p21),
    ciudad = as.factor(ciudad)
  )
```

## 游댌 Punto 3: An치lisis de Correspondencias Simples (ACS) entre p17_b y p21

```{r}
# Tabla de contingencia
tabla1 <- table(ECC_sub$p17_b, ECC_sub$p21)

# Ejecutar el ACS
res.acs <- CA(tabla1, graph = FALSE)

# Mostrar resumen
summary(res.acs)
```

### 游닇 Interpretaci칩n del ACS

El an치lisis de correspondencias simples entre la percepci칩n de facilidad para cumplir la ley (p17_b) y la preferencia por hacer acuerdos (p21) revela una asociaci칩n significativa (픦 = 290.54, p < 0.001).

La primera dimensi칩n explica el 83.7% de la varianza, lo que indica que existe una fuerte estructura en los datos.

- Las personas que consideran m치s f치cil cumplir la ley (categor칤as 3 y 4 de p17_b) tienden a estar m치s de acuerdo con hacer acuerdos (categor칤as 3 y 4 de p21).

- En contraste, quienes perciben que es dif칤cil cumplir la ley (categor칤as 1 y 2 de p17_b) muestran menor acuerdo con hacer acuerdos.

Esta asociaci칩n sugiere que las personas que consideran f치cil cumplir la ley tienden a mostrar mayor preferencia por hacer acuerdos, mientras que aquellas que consideran dif칤cil cumplir la ley manifiestan menor disposici칩n hacia el consenso. Esta relaci칩n se observa claramente en el primer eje del plano factorial, que explica m치s del 80% de la varianza.

### 游늳 Visualizaci칩n del ACS

```{r}
fviz_ca_biplot(res.acs, repel = TRUE) +
  labs(title = "ACS: Facilidad para cumplir la ley (p17_b) vs Preferencia por acuerdos (p21)")
```





### 游댌 Interpretaci칩n gr치fico:

Este gr치fico representa un plano factorial del An치lisis de Correspondencias Simples (ACS) entre:

- p17_b: Facilidad para cumplir la ley

- p21: Preferencia por hacer acuerdos

Cada punto representa una categor칤a de respuesta de cada variable, y su posici칩n indica relaciones de asociaci칩n:

Los puntos m치s cercanos entre s칤 indican que esas categor칤as tienden a coaparecer en las respuestas.

Los extremos del eje Dim.1 (que explica el 83.7% de la variabilidad) separan a los encuestados en funci칩n de sus respuestas.

游빌 Hallazgos clave:
En el cuadrante inferior derecho, se agrupan:

- p17b_FACL=4_s (muy f치cil cumplir la ley)

- p21_HACACU=4_s (muy de acuerdo con hacer acuerdos)

Esto indica que quienes consideran que es muy f치cil cumplir la ley tienden a estar muy de acuerdo con hacer acuerdos.

En el cuadrante superior izquierdo, aparecen:

- p17b_FACL=1_n y 2_cn (nada o poco f치cil cumplir la ley)

- p21_HACACU=1_n y 2_cn (nada o poco de acuerdo con hacer acuerdos)

Esto sugiere que quienes consideran que cumplir la ley es dif칤cil tambi칠n tienden a estar menos de acuerdo con hacer acuerdos.

游늷 Conclusi칩n: Existe una clara asociaci칩n entre ambas variables. La percepci칩n de legalidad parece estar positivamente relacionada con la disposici칩n al consenso.

## 游깴 Punto 4: Preferencia por acuerdos (p21) seg칰n ciudad

```{r}
# Tabla de frecuencias
tabla2 <- table(ECC_sub$ciudad, ECC_sub$p21)

# Proporciones por ciudad (filas)
prop_ciudad <- prop.table(tabla2, margin = 1)

# Convertir a formato largo
df_plot <- as.data.frame(prop_ciudad) %>%
  rename(ciudad = Var1, p21 = Var2, proporcion = Freq)
```

### 游늵 Gr치fico de barras apiladas por ciudad

```{r}
ggplot(df_plot, aes(x = ciudad, y = proporcion, fill = p21)) +
  geom_bar(stat = "identity") +
  labs(title = "Preferencia por hacer acuerdos (p21) por ciudad",
       x = "Ciudad", y = "Proporci칩n") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
### 游댌 Interpretaci칩n gr치fico:
Este gr치fico de barras apiladas muestra las proporciones de respuestas a la pregunta p21 por ciudad. Se analizan 4 niveles:

- 1_n: Nada de acuerdo

- 2_cn: Poco de acuerdo

- 3_cs: De acuerdo

- 4_s: Muy de acuerdo

游빌 Hallazgos clave:

- Bogot치 destaca con una alta proporci칩n en la categor칤a 4_s (muy de acuerdo), similar a Asunci칩n y Medell칤n.

- Caracas y Montevideo tienen una mayor proporci칩n en 1_n y 2_cn, indicando menos disposici칩n a hacer acuerdos.

- M칠xico DF muestra una distribuci칩n m치s equilibrada, pero con una leve inclinaci칩n hacia el acuerdo (3_cs).

游늷 Conclusi칩n: Existen diferencias claras entre ciudades. Algunas, como Bogot치, muestran un perfil m치s orientado al consenso, mientras que otras como Caracas presentan una mayor resistencia.

```{r}

```


```{r}

```
### **Laboratorio 5**
```{r librerias, message=FALSE, warning=FALSE}
datos_bogota <- ECC %>%
  filter(ciudad2 == "Bogota")
```

# Filtrado variables activas

```{r librerias, message=FALSE, warning=FALSE}
vars_act <- c(
  "p20_a","p20_b","p20_c","p20_d","p20_e",
  "p20_f","p20_g","p20_h","p20_i","p20_j",
  "p20_k","p21","p27",
  "p33_a","p33_b","p33_c","p33_d","p33_e",
  "p33_f","p33_g","p33_h","p33_i","p33_j",
  "p33_k","p33_l","p33_m","p33_n","p33_o","p33_p"
)
df_mca <- datos_bogota[, vars_act]

```

# Calculo de MCA

```{r librerias, message=FALSE, warning=FALSE}
mca <- MCA(df_mca, graph = FALSE)

```

# Gr치fico individuos

```{r librerias, message=FALSE, warning=FALSE}
fviz_mca_ind(
  mca,
  col.ind = "cos2",
  title   = "MCA: Individuos"
)

```